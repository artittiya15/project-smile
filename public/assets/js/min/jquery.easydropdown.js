!function(e){function t(){this.isField=!0,this.down=!1,this.inFocus=!1,this.disabled=!1,this.cutOff=!1,this.hasLabel=!1,this.hasAnotherClass=!1,this.keyboardMode=!1,this.nativeTouch=!0,this.wrapperClass="dropdowns",this.onChange=null}t.prototype={constructor:t,instances:[],init:function(t,s){var o=this;e.extend(o,s),o.$select=e(t),o.id=t.id,o.options=[],o.$options=o.$select.find("option"),o.isTouch="ontouchend"in document,o.$select.removeClass(o.wrapperClass+" dropdown "),o.$select.is(":disabled")&&(o.disabled=!0),o.$options.length&&(o.$options.each(function(t){var s=e(this);s.is(":selected")&&(o.selected={index:t,title:s.text()},o.focusIndex=t),s.hasClass("label")&&0==t?(o.hasLabel=!0,o.label=s.text(),s.attr("value","")):s.hasClass("another")?o.options.push({domNode:s[0],title:s.text(),value:"",selected:s.is(":selected"),class:"another"}):o.options.push({domNode:s[0],title:s.text(),value:s.val(),selected:s.is(":selected")})}),o.selected||(o.selected={index:0,title:o.$options.eq(0).text()},o.focusIndex=0),o.render(""))},render:function(t){var s=this,o=s.isTouch&&s.nativeTouch?" touch":"",n=s.disabled?" disabled":"";for(s.$container=s.$select.wrap('<div class="'+s.wrapperClass+o+n+" "+t+'  " ><span class="old"/></div>').parent().parent(),s.$active=e('<span class="selected">'+s.selected.title+"</span>").appendTo(s.$container),s.$carat=e('<span class="carat"/>').appendTo(s.$container),s.$scrollWrapper=e("<div><ul/></div>").appendTo(s.$container),s.$dropDown=s.$scrollWrapper.find("ul"),s.$form=s.$container.closest("form"),e.each(s.options,function(){var e=this.selected?" active":"",t=this.class?" another":"";s.$dropDown.append('<li class="'+e+t+'">'+this.title+"</li>")}),s.$items=s.$dropDown.find("li"),s.maxHeight=0,s.cutOff&&s.$items.length>s.cutOff&&s.$container.addClass("scrollable"),i=0;i<s.$items.length;i++){var c=s.$items.eq(i);if(s.maxHeight+=c.outerHeight(),s.cutOff==i+1)break}s.isTouch&&s.nativeTouch?s.bindTouchHandlers():s.bindHandlers()},bindTouchHandlers:function(){var t=this;t.$container.on("click.easyDropDown",function(){t.$select.focus()}),t.$select.on({change:function(){var s=e(this).find("option:selected"),o=s.text(),n=s.val();t.$active.text(o),"function"==typeof t.onChange&&t.onChange.call(t.$select[0],{title:o,value:n})},focus:function(){t.$container.addClass("focus")},blur:function(){t.$container.removeClass("focus")}})},bindHandlers:function(){var t=this;t.query="",t.$container.on({"click.easyDropDown":function(){t.down||t.disabled?t.close():t.open()},"mousemove.easyDropDown":function(){t.keyboardMode&&(t.keyboardMode=!1)}}),e("body").on("click.easyDropDown."+t.id,function(s){var o=e(s.target),n=t.wrapperClass.split(" ").join(".");!o.closest("."+n).length&&t.down&&t.close()}),t.$items.on({"click.easyDropDown":function(){var s=e(this).index();t.select(s),t.$select.focus()},"mouseover.easyDropDown":function(){if(!t.keyboardMode){var s=e(this);s.addClass("focus").siblings().removeClass("focus"),t.focusIndex=s.index()}},"mouseout.easyDropDown":function(){t.keyboardMode||e(this).removeClass("focus")}}),t.$select.on({"focus.easyDropDown":function(){t.$container.addClass("focus"),t.inFocus=!0},"blur.easyDropDown":function(){t.$container.removeClass("focus"),t.inFocus=!1},"keydown.easyDropDown":function(e){if(t.inFocus){t.keyboardMode=!0;var s=e.keyCode;if(38!=s&&40!=s&&32!=s||(e.preventDefault(),38==s?(t.focusIndex--,t.focusIndex=t.focusIndex<0?t.$items.length-1:t.focusIndex):40==s&&(t.focusIndex++,t.focusIndex=t.focusIndex>t.$items.length-1?0:t.focusIndex),t.down||t.open(),t.$items.removeClass("focus").eq(t.focusIndex).addClass("focus"),t.cutOff&&t.scrollToView(),t.query=""),t.down)if(9==s||27==s)t.close();else{if(13==s)return e.preventDefault(),t.select(t.focusIndex),t.close(),!1;if(8==s)return e.preventDefault(),t.query=t.query.slice(0,-1),t.search(),clearTimeout(t.resetQuery),!1;if(38!=s&&40!=s){var o=String.fromCharCode(s);t.query+=o,t.search(),clearTimeout(t.resetQuery)}}}},"keyup.easyDropDown":function(){t.resetQuery=setTimeout(function(){t.query=""},1200)}}),t.$dropDown.on("scroll.easyDropDown",function(e){t.$dropDown[0].scrollTop>=t.$dropDown[0].scrollHeight-t.maxHeight?t.$container.addClass("bottom"):t.$container.removeClass("bottom")}),t.$form.length&&t.$form.on("reset.easyDropDown",function(){var e=t.hasLabel?t.label:t.options[0].title;t.$active.text(e)})},unbindHandlers:function(){this.$container.add(this.$select).add(this.$items).add(this.$form).add(this.$dropDown).off(".easyDropDown"),e("body").off("."+this.id)},open:function(){var e=window.scrollY||document.documentElement.scrollTop,t=window.scrollX||document.documentElement.scrollLeft,s=this.notInViewport(e);this.closeAll(),this.$select.focus(),window.scrollTo(t,e+s),this.$container.addClass("open"),this.$scrollWrapper.css("height",this.maxHeight+"px"),this.$scrollWrapper.addClass("dropdownHeight"),this.down=!0},close:function(){this.$container.removeClass("open"),this.$scrollWrapper.css("height","0px"),this.focusIndex=this.selected.index,this.query="",this.down=!1},closeAll:function(){var e=Object.getPrototypeOf(this).instances;for(var t in e){e[t].close()}},select:function(t){console.log(this.id),e("#label"+this.id).fadeIn(),"string"==typeof t&&(t=this.$select.find("option[value="+t+"]").index()-1);var s=this.options[t],o=this.hasLabel?t+1:t;this.$items.removeClass("active").eq(t).addClass("active"),this.$active.text(s.title),this.$select.find("option").removeAttr("selected").eq(o).prop("selected",!0).parent().trigger("change"),this.selected={index:t,title:s.title},this.focusIndex=i,"function"==typeof this.onChange&&this.onChange.call(this.$select[0],{title:s.title,value:s.value})},search:function(){var e=this,t=function(t){e.focusIndex=t,e.$items.removeClass("focus").eq(e.focusIndex).addClass("focus"),e.scrollToView()},s=function(t){return e.options[t].title.toUpperCase()};for(i=0;i<e.options.length;i++){if(0==(o=s(i)).indexOf(e.query))return void t(i)}for(i=0;i<e.options.length;i++){var o=s(i);if(o.indexOf(e.query)>-1){t(i);break}}},scrollToView:function(){if(this.focusIndex>=this.cutOff){var e=this.$items.eq(this.focusIndex).outerHeight()*(this.focusIndex+1)-this.maxHeight;this.$dropDown.scrollTop(e)}},notInViewport:function(e){var t={min:e,max:e+(window.innerHeight||document.documentElement.clientHeight)},s=this.$dropDown.offset().top+this.maxHeight;return s>=t.min&&s<=t.max?0:s-t.max+5},destroy:function(){this.unbindHandlers(),this.$select.unwrap().siblings().remove(),this.$select.unwrap(),delete Object.getPrototypeOf(this).instances[this.$select[0].id]},disable:function(){this.disabled=!0,this.$container.addClass("disabled"),this.$select.attr("disabled",!0),this.down||this.close()},enable:function(){this.disabled=!1,this.$container.removeClass("disabled"),this.$select.attr("disabled",!1)}};var s=function(e,s){e.id=e.id?e.id:"EasyDropDown"+o();var n=new t;n.instances[e.id]||(n.instances[e.id]=n,n.init(e,s))},o=function(){return("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6).toUpperCase()};e.fn.easyDropDown=function(){var e,o=arguments,n=[];return e=this.each(function(){if(o&&"string"==typeof o[0]){var e=t.prototype.instances[this.id][o[0]](o[1],o[2]);e&&n.push(e)}else s(this,o[0])}),n.length?n.length>1?n:n[0]:e},e(function(){"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"test".__proto__?function(e){return e.__proto__}:function(e){return e.constructor.prototype}),e("select.dropdown").each(function(){var t=e(this).attr("data-settings");settings=t?e.parseJSON(t):{},s(this,settings)})})}(jQuery);